var editor=function(t,e,o){var n,i,r,a,h,d=function(t){n=new o.Canvas(t.canvas_id),a={width:n.width,height:n.height},h=s(n,a),_oMask=u(n,h)},s=function(t,e){return{left:(t.width-e.width)/2,top:(t.height-e.height)/2,width:e.width,height:e.height}},l=function(t,e){var o=e.width/e.height,n=t.width/t.height,i=1;return i=n>o?e.height/t.height:e.width/t.width},f=function(t,e,o){e.scale(l(e,{width:o.width,height:o.height})),e.left=o.left,e.top=o.top,e.hasRotatingPoint=!1,t.add(e),t.moveTo(e,0)},u=function(t,e){console.log("draw_mask"),console.log(e);var n=[{x:0,y:0},{x:t.width,y:0},{x:t.width,y:t.height},{x:0,y:t.height},{x:0,y:e.top},{x:e.left,y:e.top},{x:e.left,y:e.top+e.height+1},{x:e.left+e.width+1,y:e.top+e.height+1},{x:e.left+e.width+1,y:e.top},{x:0,y:e.top}],i="M 0 0"+n.map(function(t){return" L "+t.x+" "+t.y}).join(""),r=new o.Path(i);return r.set({opacity:.8,evented:!1,selectable:!1,hasControls:!1}),t.add(r),t.moveTo(r,1),r},c=function(t,e){var n=new o.Rect({left:e.left-1,top:e.top-1,width:e.width+2,height:e.height+2,strokeWidth:1,fill:null,stroke:"#FF0000",evented:!1,selectable:!1,hasControls:!1});t.add(n),t.moveTo(n,2)},g=function(t){return"undefined"==typeof t?!1:void t.set({hasControls:!t.hasControls,hasBorders:!t.hasBorders})},p=function(e,o){a={width:parseInt(e),height:parseInt(o)},h=s(n,a),r?t.load_img(r):(n.clear(),u(n,h),c(n,h))},v=function(t){i=t;var e=s(n,h);n.clear(),f(n,t,e),u(n,e),c(n,e)};return t.load_img=function(t){r=t,o.Image.fromURL(r,v)},t.snapshot=function(){var t=h;return t.format="jpg",g(i),data_src=n.toDataURL(t),g(i),data_src},t.init=d,t.set_dimension=p,t}(editor||{},jQuery,fabric),ui=function(t,e,o){var n,i,r=function(t){n=t,i=e(t.dropzone_id),a(i)},a=function(t){t.on("dragover",function(){return t.addClass("dropzone--hover"),!1}),t.on("dragleave",function(){return t.removeClass("dropzone--hover"),!1}),t.on("drop",function(e){return e.stopPropagation(),e.preventDefault(),t.removeClass("dropzone--hover"),h(e.originalEvent.dataTransfer.files),!1})},h=function(t){if(t&&"undefined"!=typeof FileReader)for(var e=0;e<t.length;e++)d(t[e]);else console.log("wrong file format")},d=function(t){if(/image/i.test(t.type)){var e=new FileReader;e.onload=function(t){o.load_img(t.target.result)},e.readAsDataURL(t)}else console.log("error")};return t.change_dimension=function(t,e){return o.set_dimension(t,e)},t.preview=function(){return o.snapshot()},t.init=r,t}(ui||{},jQuery,editor);